# PRD-005: Transcript Harvester Agent

**Version**: 1.0  
**Date**: 2025-11-18  
**Phase**: 2 - Intelligence Layer  
**Duration**: 3 days  
**Status**: Not Started  
**Dependencies**: PRD-003, PRD-004

---

## Objective

Build AI agent that converts videos to transcripts and extracts structured insights. This is CRITICAL as video content contains the highest-value alpha.

---

## Success Criteria

- [ ] Transcribes Zoom/Webex videos from Discord
- [ ] Transcribes YouTube videos
- [ ] Uses Whisper API for audio → text
- [ ] Claude analyzes transcripts for themes, tickers, sentiment
- [ ] <$0.50 per video cost
- [ ] >90% accuracy (Sebastian validates)
- [ ] Handles 30+ minute videos

---

## Agent Specification

### Input
```python
{
    "video_url": "https://zoom.us/rec/share/...",
    "source": "discord|youtube",
    "metadata": {
        "speaker": "Imran Lakha",
        "date": "2025-11-18",
        "title": "CRYPTO VOL UPDATE"
    }
}
```

### Output
```python
{
    "transcript": "full text with timestamps...",
    "key_themes": ["VIX spike", "Dec OPEX positioning", "tech sector rotation"],
    "tickers_mentioned": ["SPY", "VIX", "NVDA", "META"],
    "sentiment": "bearish",
    "conviction": 8,
    "time_horizon": "1w",
    "catalysts": ["FOMC meeting Dec 18", "NVDA earnings"],
    "falsification_criteria": ["If VIX drops below 15", "If SPY breaks 5850"],
    "key_quotes": [
        {
            "timestamp": "00:05:32",
            "text": "The vol premium is screaming that market makers are positioned for downside."
        }
    ]
}
```

---

## Implementation

### Video Processing Pipeline
1. **Download Video** (if needed)
   - Zoom/Webex: Use yt-dlp or direct download
   - YouTube: Use yt-dlp
2. **Extract Audio**
   - Convert to MP3/WAV
   - Optimize for Whisper (16kHz, mono)
3. **Transcribe with Whisper API**
   - Send audio file
   - Get timestamped transcript
4. **Analyze with Claude**
   - Extract themes, tickers, sentiment
   - Generate structured output

### File: `agents/transcript_harvester.py`

```python
class TranscriptHarvesterAgent:
    def __init__(self, claude_api_key, whisper_api_key):
        self.claude = anthropic.Anthropic(api_key=claude_api_key)
        self.openai = openai.OpenAI(api_key=whisper_api_key)
    
    async def harvest(self, video_url, metadata):
        """Full pipeline: video → transcript → analysis."""
        audio_file = await self.download_and_extract_audio(video_url)
        transcript = await self.transcribe(audio_file)
        analysis = await self.analyze_transcript(transcript, metadata)
        return analysis
    
    async def download_and_extract_audio(self, video_url):
        """Download video and extract audio."""
        pass
    
    async def transcribe(self, audio_file):
        """Use Whisper API for transcription."""
        pass
    
    async def analyze_transcript(self, transcript, metadata):
        """Use Claude to extract insights."""
        pass
```

### Claude Prompt for Analysis
```
You are analyzing a financial market analysis video transcript.

Speaker: {speaker}
Date: {date}
Source: {source}

Transcript:
{transcript}

Extract the following in JSON format:
- key_themes: List of main macro/market themes discussed
- tickers_mentioned: Specific securities or indexes mentioned
- sentiment: Overall market sentiment (bullish/bearish/neutral)
- conviction: Strength of view (0-10)
- time_horizon: Expected timeframe for thesis (1d/1w/1m/3m/6m+)
- catalysts: Upcoming events that matter
- falsification_criteria: What would invalidate this view
- key_quotes: 3-5 most important quotes with timestamps

Focus on actionable insights, not general commentary.
```

---

## Tasks

### Task 5.1: Video Download Module
**Estimate**: 4 hours

Implement video downloading using yt-dlp for Zoom/Webex/YouTube.

### Task 5.2: Audio Extraction
**Estimate**: 2 hours

Convert video to audio format suitable for Whisper.

### Task 5.3: Whisper API Integration
**Estimate**: 3 hours

Send audio to Whisper API, handle large files (chunking if needed).

### Task 5.4: Claude Transcript Analysis
**Estimate**: 4 hours

Build prompt and parsing logic for structured output.

### Task 5.5: Cost Optimization
**Estimate**: 2 hours

Cache transcripts, compress audio efficiently.

### Task 5.6: Write Tests
**Estimate**: 3 hours

Test on 5 Imran videos, 3 Darius videos.

---

## Testing Plan

### Test Videos
1. Discord: Imran's crypto vol update (18 Nov)
2. Discord: Imran's SPX vol update
3. 42macro: Darius Dale Macro Minute
4. YouTube: Peter Diamandis interview
5. YouTube: Jordi Visser market commentary

### Validation
Sebastian reviews output and confirms:
- Themes are accurate
- Sentiment matches his assessment
- Key quotes are relevant
- Falsification criteria make sense

---

## Performance & Cost

### Target Performance
- 5 minute video: Complete in <60 seconds
- 30 minute video: Complete in <5 minutes

### Cost Breakdown (per 30min video)
- Whisper API: ~$0.36 (at $0.006/minute)
- Claude API: ~$0.10 (for analysis)
- **Total: ~$0.46** ✓ Under $0.50 target

---

## Deliverables

1. `agents/transcript_harvester.py` - Complete agent
2. `tests/test_agents/test_transcript_harvester.py` - Tests
3. Sample transcripts and analysis results
4. Documentation of analysis prompt

---

**Status**: Ready after PRD-003, PRD-004 completion

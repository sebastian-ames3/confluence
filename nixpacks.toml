# Nixpacks configuration for Railway deployment
# Force Python by installing it directly via Nix packages
# (providers=["python"] didn't work - package.json still caused Node.js detection)

[phases.setup]
nixPkgs = ["python311", "python311Packages.pip", "python311Packages.virtualenv", "ffmpeg", "chromium", "chromedriver"]

[phases.install]
# Create venv and install deps (Nix pip is externally-managed, can't install to system)
cmds = ["python3.11 -m venv /app/.venv", "/app/.venv/bin/pip install -r requirements.txt"]

[start]
cmd = "/app/.venv/bin/python scripts/run_migrations.py --auto && /app/.venv/bin/python -m uvicorn backend.app:app --host 0.0.0.0 --port $PORT"

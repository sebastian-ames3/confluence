# PRD-003: Content Classifier Agent

**Version**: 1.0  
**Date**: 2025-11-18  
**Phase**: 1 - Foundation  
**Duration**: 2 days  
**Status**: Not Started  
**Dependencies**: PRD-002

---

## Objective

Build the first AI sub-agent that triages all incoming content, determines type, assigns priority, and routes to appropriate specialized agents for analysis.

---

## Success Criteria

- [ ] Correctly classifies content from all 6 sources
- [ ] Handles text, PDF, video URLs, images
- [ ] Routes to appropriate agents
- [ ] <2 seconds per classification
- [ ] 95%+ accuracy on test dataset
- [ ] Unit tests passing
- [ ] Integration with database working

---

## Agent Specification

### Input
```python
{
    "raw_content_id": 123,
    "content_type": "text|pdf|video|image",
    "content_text": "...",  # if text
    "file_path": "...",  # if file
    "url": "...",  # if video
    "source": "42macro|discord|twitter|youtube|substack",
    "metadata": {...}
}
```

### Output
```python
{
    "classification": "transcript_needed|pdf_analysis|image_intelligence|simple_text",
    "priority": "high|medium|low",
    "route_to_agents": ["transcript_harvester", "pdf_analyzer"],
    "detected_topics": ["Fed policy", "tech sector"],
    "estimated_processing_time": 120,  # seconds
    "confidence": 0.95
}
```

### Claude Prompt
```
You are a content classification agent for investment research.

Analyze the following content and classify it:
- Content type: text, PDF, video, or image
- Priority: high (trade ideas, earnings), medium (weekly reports), low (general commentary)
- Required processing: which specialized agents should analyze this?

Content:
{content_preview}

Source: {source_name}

Respond with JSON only.
```

---

## Implementation

### File: `agents/content_classifier.py`

```python
class ContentClassifierAgent:
    def __init__(self, claude_api_key):
        self.client = anthropic.Anthropic(api_key=claude_api_key)
    
    def classify(self, raw_content):
        """Classify raw content and determine routing."""
        pass
    
    def _build_prompt(self, raw_content):
        """Build Claude prompt for classification."""
        pass
    
    def _parse_response(self, claude_response):
        """Parse Claude's JSON response."""
        pass
    
    def _determine_priority(self, content, source):
        """Apply priority rules."""
        pass
```

### Priority Rules
- **High**: 
  - Discord videos from Imran
  - 42macro "Leadoff Morning Note"
  - Twitter posts from @KTTECHPRIVATE with trade setups
- **Medium**:
  - 42macro weekly reports
  - YouTube videos from followed channels
  - Substack posts
- **Low**:
  - General Twitter commentary
  - Discord text-only messages without charts

### Routing Logic
- Video URL detected → `transcript_harvester`
- PDF file → `pdf_analyzer`
- Image file → `image_intelligence`
- Text with high information density → Direct to `confluence_scorer`
- Text with low density → Archive only

---

## Tasks

### Task 3.1: Implement ContentClassifierAgent
**Estimate**: 4 hours

Build the base agent class with Claude API integration.

### Task 3.2: Create Priority Rules Engine
**Estimate**: 2 hours

Implement logic for assigning priority based on source and content type.

### Task 3.3: Write Unit Tests
**Estimate**: 3 hours

Test classification accuracy on sample data from each source.

### Task 3.4: Integration with Database
**Estimate**: 2 hours

Save classification results to database, update raw_content.processed flag.

### Task 3.5: Performance Optimization
**Estimate**: 2 hours

Ensure <2 second classification time, add caching for similar content.

---

## Testing Plan

### Test Dataset
- 10 Discord text messages
- 5 Discord video links (Zoom/Webex)
- 5 42macro PDFs
- 5 Twitter posts (text + video)
- 5 YouTube URLs
- 3 images (volatility charts)
- 5 Substack articles

### Success Metrics
- Correct classification: 95%+
- Correct priority: 90%+
- Correct routing: 95%+
- Average response time: <2s

---

## Deliverables

1. `agents/content_classifier.py` - Agent implementation
2. `agents/base_agent.py` - Base class for all agents
3. `tests/test_agents/test_content_classifier.py` - Test suite
4. Documentation of classification logic

---

**Status**: Ready after PRD-002 completion

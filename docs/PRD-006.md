# PRD-006: PDF Analyzer Agent

**Version**: 1.0  
**Date**: 2025-11-18  
**Phase**: 2 - Intelligence Layer  
**Duration**: 2 days  
**Status**: Not Started  
**Dependencies**: PRD-003

---

## Objective

Extract structured insights from PDF research reports (42macro, Discord attachments).

---

## Success Criteria

- [ ] Extracts text from all PDF types (text-based, scanned)
- [ ] Parses tables and charts
- [ ] Claude analysis extracts themes, valuations, positioning
- [ ] Handles 42macro specific formats (KISS model, ATH, MSR)
- [ ] Sebastian validates 10 PDFs with >90% accuracy
- [ ] <10 seconds per PDF

---

## Agent Specification

### Input
```python
{
    "pdf_path": "/path/to/report.pdf",
    "source": "42macro",
    "report_type": "leadoff|ath|msr",
    "date": "2025-11-18"
}
```

### Output
```python
{
    "extracted_text": "full text...",
    "tables": [{"name": "KISS Portfolio", "data": [...]}],
    "key_themes": ["Disinflationary growth", "Tech outperformance"],
    "market_regime": "growth_acceleration",
    "positioning": {
        "equities": "overweight",
        "bonds": "underweight",
        "commodities": "neutral"
    },
    "valuations": {
        "SPX_PE": 21.5,
        "implied_earnings_growth": 0.08
    },
    "tickers_mentioned": ["SPY", "TLT", "GLD"],
    "conviction": 7
}
```

---

## Implementation

### PDF Processing Pipeline
1. **Text Extraction**: pypdf2 or pdfplumber
2. **Table Extraction**: camelot or tabula
3. **OCR (if needed)**: pytesseract for scanned PDFs
4. **Claude Analysis**: Extract structured insights

### File: `agents/pdf_analyzer.py`

```python
class PDFAnalyzerAgent:
    def __init__(self, claude_api_key):
        self.claude = anthropic.Anthropic(api_key=claude_api_key)
    
    def analyze(self, pdf_path, metadata):
        """Full pipeline: PDF → text+tables → analysis."""
        text = self.extract_text(pdf_path)
        tables = self.extract_tables(pdf_path)
        analysis = self.analyze_content(text, tables, metadata)
        return analysis
    
    def extract_text(self, pdf_path):
        """Extract text from PDF."""
        pass
    
    def extract_tables(self, pdf_path):
        """Extract tables from PDF."""
        pass
    
    def analyze_content(self, text, tables, metadata):
        """Claude analysis."""
        pass
```

---

## Tasks

### Task 6.1: PDF Text Extraction
**Estimate**: 3 hours

### Task 6.2: Table Extraction
**Estimate**: 4 hours

### Task 6.3: Claude Analysis Integration
**Estimate**: 3 hours

### Task 6.4: 42macro Format Handling
**Estimate**: 3 hours

Special parsing for KISS model, regime indicators.

### Task 6.5: Write Tests
**Estimate**: 2 hours

---

## Deliverables

1. `agents/pdf_analyzer.py`
2. Tests with 10 sample PDFs
3. Documentation

---

**Status**: Ready after PRD-003

# PRD-012: Dashboard Simplification & Synthesis Agent

**Version**: 1.0
**Date**: 2025-11-28
**Phase**: 5 - Simplification
**Status**: In Progress

---

## Objective

Transform the Macro Confluence Hub from a complex scoring dashboard into a **research synthesis assistant**. The user wants AI-generated summaries of collected research rather than numeric confluence scores displayed in the UI.

**Key Insight**: Scoring/confluence logic remains **internal only** - used by the AI to weight information, but not displayed to the user.

---

## User Requirements (from Sebastian)

1. **Simple status display**: What was collected, when, from where
2. **AI synthesis**: 1-3 paragraph summary of macro themes and ideas
3. **Internal scoring**: Let Claude naturally weight information with proper persona prompt
4. **Chat integration**: Connect to Claude Desktop via MCP (see PRD-013)

---

## Success Criteria

- [ ] Dashboard simplified to single status page
- [ ] Synthesis Agent created with macro analyst persona
- [ ] Synthesis generated after each collection run
- [ ] Synthesis stored in database for retrieval
- [ ] Frontend displays latest synthesis prominently
- [ ] Collection status clearly visible (last run, items collected, sources)
- [ ] Unit tests passing
- [ ] Integration tested with real data

---

## Technical Specifications

### Part A: Synthesis Agent

**File**: `agents/synthesis_agent.py`

**Purpose**: Generate human-readable research synthesis from collected content

**Persona Prompt**:
```
You are an experienced macro analyst synthesizing investment research from multiple premium sources.
You naturally weight evidence based on:
- Source credibility and track record
- Recency of information
- Cross-source confluence (multiple independent sources agreeing)
- Clarity of the investment thesis
- Presence of clear falsification criteria

Provide a concise synthesis (1-3 paragraphs) highlighting:
1. Key macro themes across sources
2. High-conviction ideas where multiple sources align
3. Notable contradictions or divergences worth monitoring
4. Any significant regime shifts or catalyst events

Write for a sophisticated investor who wants to quickly understand the current research landscape.
```

**Input**:
```json
{
  "content_items": [
    {
      "source": "42macro",
      "type": "pdf",
      "title": "Around The Horn - Nov 28",
      "summary": "...",
      "themes": ["Fed policy", "equity positioning"],
      "timestamp": "2025-11-28T06:00:00Z"
    }
  ],
  "time_window": "24h"
}
```

**Output**:
```json
{
  "synthesis": "The past 24 hours of research shows...",
  "key_themes": ["theme1", "theme2"],
  "high_conviction_ideas": [
    {
      "idea": "Long gold on Fed pivot expectations",
      "sources": ["42macro", "Options Insight"],
      "confidence": "high"
    }
  ],
  "contradictions": [
    {
      "topic": "Tech sector",
      "views": {"42macro": "cautious", "KT Technical": "bullish breakout"}
    }
  ],
  "generated_at": "2025-11-28T18:30:00Z"
}
```

### Part B: Dashboard Simplification

**Current State**: 6 complex pages with scoring matrices, theme trackers, confluence heatmaps

**Target State**: Single simple page with:
1. **Status Panel** (top)
   - Last collection time
   - Items collected per source (counts)
   - Any collection errors

2. **Synthesis Panel** (main content)
   - Latest AI synthesis (1-3 paragraphs)
   - Key themes as simple tags
   - High-conviction ideas list

3. **Collection History** (bottom)
   - Simple table of recent collections
   - Date, source, item count, status

### Part C: Backend Changes

**New Endpoint**: `POST /api/synthesis/generate`
- Triggers synthesis generation for specified time window
- Called automatically after collection runs

**New Endpoint**: `GET /api/synthesis/latest`
- Returns most recent synthesis
- Used by dashboard

**New Endpoint**: `GET /api/status`
- Returns collection status (last runs, counts, errors)
- Used by dashboard status panel

**Database Table**: `syntheses`
```sql
CREATE TABLE IF NOT EXISTS syntheses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    synthesis TEXT NOT NULL,
    key_themes TEXT,  -- JSON array
    high_conviction_ideas TEXT,  -- JSON array
    contradictions TEXT,  -- JSON array
    time_window TEXT NOT NULL,  -- "24h", "7d", etc.
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    token_usage INTEGER
);
```

---

## Implementation Tasks

### Task 12.1: Create Synthesis Agent
**Estimate**: 2-3 hours

**Actions**:
1. Create `agents/synthesis_agent.py`
2. Implement persona-based prompt
3. Add content aggregation from database
4. Generate structured synthesis output
5. Add unit tests

### Task 12.2: Create Synthesis Database Table
**Estimate**: 30 minutes

**Actions**:
1. Add `syntheses` table to schema
2. Create migration script
3. Test CRUD operations

### Task 12.3: Create Synthesis API Endpoints
**Estimate**: 1-2 hours

**Actions**:
1. Create `backend/routes/synthesis.py`
2. Implement `/api/synthesis/generate`
3. Implement `/api/synthesis/latest`
4. Implement `/api/status`
5. Register routes in `app.py`
6. Add tests

### Task 12.4: Simplify Dashboard
**Estimate**: 2-3 hours

**Actions**:
1. Create new `frontend/simple-dashboard.html`
2. Implement Status Panel
3. Implement Synthesis Panel
4. Implement Collection History
5. Remove or archive old complex pages
6. Update routing

### Task 12.5: Integrate Synthesis with Scheduler
**Estimate**: 1 hour

**Actions**:
1. Modify `backend/scheduler.py`
2. Call synthesis generation after collection
3. Test end-to-end flow

---

## Testing Plan

### Unit Tests
- Synthesis Agent prompt handling
- Database operations for syntheses table
- API endpoint responses

### Integration Tests
- Full flow: Collection → Synthesis Generation → Dashboard Display
- Multiple sources aggregation
- Error handling for failed collections

### Manual Testing
- Sebastian reviews synthesis quality
- Validates key themes extraction
- Checks dashboard usability on mobile

---

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Synthesis quality poor | High | Iterate on persona prompt with Sebastian's feedback |
| Dashboard too simplistic | Medium | Can add features incrementally |
| API costs increase | Low | Synthesis runs 2x/day max, ~$2/day |

---

## Dependencies

- Existing collectors (all working)
- Claude API access
- Database with collected content

---

## Out of Scope

- MCP server integration (PRD-013)
- Complex scoring UI (intentionally removed)
- Real-time updates (future enhancement)

---

## Files Modified/Created

**New Files**:
- `agents/synthesis_agent.py`
- `backend/routes/synthesis.py`
- `frontend/simple-dashboard.html`
- `database/migrations/004_add_syntheses_table.sql`
- `tests/test_agents/test_synthesis_agent.py`
- `tests/test_routes/test_synthesis.py`

**Modified Files**:
- `backend/app.py` (add synthesis routes)
- `backend/scheduler.py` (trigger synthesis after collection)
- `database/schema.sql` (add syntheses table)

---

## Sign-off

**Developer**: ___________  Date: ___________
**Sebastian**: ___________  Date: ___________

---

**Status**: In Progress

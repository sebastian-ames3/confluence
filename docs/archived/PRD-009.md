# PRD-009: Cross-Reference Agent

**Version**: 1.0  
**Date**: 2025-11-18  
**Phase**: 3 - Confluence Engine  
**Duration**: 3 days  
**Status**: Not Started  
**Dependencies**: PRD-008

---

## Objective

Find confluence patterns across sources and time. Track theme evolution with Bayesian updating.

---

## Success Criteria

- [ ] Identifies when 2+ sources agree on theme
- [ ] Flags contradictions between sources
- [ ] Bayesian updates work correctly
- [ ] Tracks conviction evolution over time
- [ ] Dashboard visualization ready

---

## Agent Specification

### Input
```python
{
    "time_window": "7d",
    "min_sources": 2
}
```

### Output
```python
{
    "confluent_themes": [
        {
            "theme_id": 5,
            "theme": "Tech sector rotation imminent",
            "current_conviction": 0.85,
            "confidence_interval": [0.78, 0.92],
            "supporting_sources": [
                {"source": "42macro", "date": "2025-11-15", "score": 8},
                {"source": "options_insight", "date": "2025-11-17", "score": 7},
                {"source": "kt_technical", "date": "2025-11-18", "score": 9}
            ],
            "evidence_count": 3,
            "first_mentioned": "2025-11-10",
            "conviction_history": [
                {"date": "2025-11-10", "conviction": 0.3},
                {"date": "2025-11-15", "conviction": 0.6},
                {"date": "2025-11-18", "conviction": 0.85}
            ]
        }
    ],
    "contradictions": [
        {
            "theme": "Fed pivot timing",
            "source_a": {"source": "42macro", "view": "Q1 2025"},
            "source_b": {"source": "twitter_mel", "view": "No pivot in 2025"}
        }
    ]
}
```

---

## Bayesian Updating

### Formula
```
P(theme | new_evidence) = P(new_evidence | theme) * P(theme) / P(new_evidence)

Where:
- P(theme) = prior conviction
- P(new_evidence | theme) = evidence strength (from confluence score)
- P(new_evidence) = normalization constant
```

### Implementation
```python
def bayesian_update(prior_conviction, evidence_strength, evidence_reliability):
    likelihood = evidence_strength * evidence_reliability
    posterior = (likelihood * prior_conviction) / 
                (likelihood * prior_conviction + (1 - likelihood) * (1 - prior_conviction))
    return posterior
```

---

## Tasks

### Task 9.1: Theme Detection (4 hours)
### Task 9.2: Confluence Identification (4 hours)
### Task 9.3: Bayesian Update Implementation (4 hours)
### Task 9.4: Contradiction Detection (3 hours)
### Task 9.5: Historical Tracking (3 hours)
### Task 9.6: Tests (3 hours)

---

## Deliverables

1. `agents/cross_reference.py`
2. Bayesian update module
3. Tests with historical data

---

**Status**: Ready after PRD-008
